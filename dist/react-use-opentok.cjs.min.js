"use strict";var e,n=require("react"),t=(e=require("@opentok/client"))&&"object"==typeof e&&"default"in e?e.default:e;function r(e,n,t,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void t(e)}a.done?n(c):Promise.resolve(c).then(r,o)}function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],r=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(t.push(s.value),!n||t.length!==n);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return t}(e,n)||u(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,n){if(e){if("string"==typeof e)return l(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(e,n):void 0}}function l(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var f={isSessionInitialized:!1,connectionId:void 0,isSessionConnected:!1,session:void 0,connections:[],streams:[],subscribers:[],publisher:{}},d=function(e,n){var t=n.type,r=n.payload;switch(t){case"UPDATE":return s(s({},e),r);case"ADD_CONNECTION":return s(s({},e),{},{connections:[].concat(c(e.connections),[r])});case"REMOVE_CONNECTION":return s(s({},e),{},{connections:c(e.connections.filter((function(e){return e.connectionId!==r.connectionId})))});case"ADD_STREAM":return s(s({},e),{},{streams:[].concat(c(e.streams),[r])});case"REMOVE_STREAM":return s(s({},e),{},{streams:c(e.streams.filter((function(e){return e.streamId!==r.streamId})))});case"SET_PUBLISHER":var i=r.name,a=r.publisher;return s(s({},e),{},{publisher:s(s({},e.publisher),{},o({},i,a))});case"REMOVE_PUBLISHER":var u=r.name;return s(s({},e),{},{publisher:s(s({},e.publisher),{},o({},u,null))});case"ADD_SUBSCRIBER":return s(s({},e),{},{subscribers:[].concat(c(e.subscribers),[r])});case"REMOVE_SUBSCRIBER":return s(s({},e),{},{subscribers:c(e.subscribers.filter((function(e){return e.streamId!==r.streamId})))});default:return e}},p=["archiveStarted","archiveStopped","connectionCreated","connectionDestroyed","sessionConnected","sessionDisconnected","sessionReconnected","sessionReconnecting","signal","streamCreated","streamDestroyed","streamPropertyChanged"],b=function(e,t,r){if(!p.some((function(n){return e.startsWith(n)})))throw new Error("The event type is NOT supported");if("function"!=typeof t)throw new Error("Incorrect value or type of callback");n.useEffect((function(){if("string"==typeof(r||{}).sessionId)return r.on(e,t),function(){r.off(e,t)}}),[r,e,t])},m={insertMode:"append",width:"100%",height:"100%"};module.exports=function(){var e=function(){var e=a(n.useReducer(d,f),2),t=e[0],r=e[1];return[t,n.useMemo((function(){return{update:function(e){r({type:"UPDATE",payload:e})},addConnection:function(e){r({type:"ADD_CONNECTION",payload:e})},removeConnection:function(e){r({type:"REMOVE_CONNECTION",payload:e})},addStream:function(e){r({type:"ADD_STREAM",payload:e})},removeStream:function(e){r({type:"REMOVE_STREAM",payload:e})},setPublisher:function(e){var n=e.name,t=e.publisher;r({type:"SET_PUBLISHER",payload:{name:n,publisher:t}})},removePublisher:function(e){var n=e.name;r({type:"REMOVE_PUBLISHER",payload:{name:n}})},addSubscriber:function(e){r({type:"ADD_SUBSCRIBER",payload:e})},removeSubscriber:function(e){r({type:"REMOVE_SUBSCRIBER",payload:e})}}}),[])]}(),o=a(e,2),i=o[0],c=o[1],u=i.isSessionConnected,l=i.session,p=i.subscribers,y=i.publisher,v=i.streams,h=n.useCallback((function(e){c.addConnection(e.connection)}),[c]),S=n.useCallback((function(e){c.removeConnection(e.connection)}),[c]),E=n.useCallback((function(e){c.addStream(e.stream)}),[c]),O=n.useCallback((function(e){c.removeStream(e.stream)}),[c]),C=n.useCallback((function(e){var n=e.apiKey,r=e.sessionId,o=e.sessionOptions;return new Promise((function(e){var i=t.initSession(n,r,o);c.update({session:i,isSessionInitialized:!0}),e(i)}))}),[c]),I=n.useCallback((function(e,n){return new Promise((function(t,r){return e?n?void n.connect(e,(function(e){if(e)r(e);else{var o=n.connection.connectionId;c.update({connectionId:o,isSessionConnected:!0}),t(o)}})):r("[react-use-opentok] session does not exist."):r("[react-use-opentok] token does not exist.")}))}),[c]),w=n.useCallback(function(){var e,n=(e=regeneratorRuntime.mark((function e(n){var t,r,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.apiKey,r=n.sessionId,o=n.token,i=n.sessionOptions,e.next=3,C({apiKey:t,sessionId:r,sessionOptions:i});case 3:return s=e.sent,e.next=6,I(o,s);case 6:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(o,i){var s=e.apply(n,t);function a(e){r(s,o,i,a,c,"next",e)}function c(e){r(s,o,i,a,c,"throw",e)}a(void 0)}))});return function(e){return n.apply(this,arguments)}}(),[I,C]),R=n.useCallback((function(){l.disconnect(),c.update({connectionId:null,isSessionConnected:!1,session:void 0})}),[c,l]),g=n.useCallback((function(e){var n=e.name,r=e.element,o=e.options;if(y[n])throw new Error("The publisher(".concat(n,") is already existed"));return new Promise((function(e,n){e(t.initPublisher(r,s(s({},m),o),(function(e){e&&n(e)})))})).then((function(e){return new Promise((function(t,r){l.publish(e,(function(o){o?r(o):(c.setPublisher({name:n,publisher:e}),c.addStream(e.stream),t(e.stream))}))}))}))}),[c,y,l]),P=n.useCallback((function(e){var n=e.name;if(!y||!y[n])throw new Error("[unpublish] publisher[".concat(n,"] is undefined"));var t=y&&y[n]&&y[n].stream;l.unpublish(y[n]),c.removePublisher({name:n}),c.removeStream(t)}),[c,y,l]),D=n.useCallback((function(e){var n=e.stream,t=e.element,r=e.options,o=n.streamId,i=v.find((function(e){return e.streamId===o})),a=l.subscribe(i,t,s(s({},m),r));c.addSubscriber(a)}),[c,l,v]),A=n.useCallback((function(e){var n=e.stream.streamId,t=p.find((function(e){return e.streamId===n}));l.unsubscribe(t),c.removeSubscriber(t)}),[c,l,p]),k=n.useCallback((function(e){var n=e.type,t=e.data,r=e.completionHandler;if(!u)throw new Error("Session is not connected");var o={data:t};"string"==typeof n&&n.length>0&&(o.type=n),l.signal(o,(function(e){e?console.warn("signal error: "+e.message):"function"==typeof r&&r()}))}),[u,l]);return b("connectionCreated",h,l),b("connectionDestroyed",S,l),b("streamCreated",E,l),b("streamDestroyed",O,l),[i,{initSessionAndConnect:w,initSession:C,connectSession:I,disconnectSession:R,publish:g,unpublish:P,subscribe:D,unsubscribe:A,sendSignal:k}]};
//# sourceMappingURL=react-use-opentok.cjs.min.js.map
