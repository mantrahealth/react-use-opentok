{"version":3,"file":"react-use-opentok.cjs.js","sources":["../src/libs/use-opentok-reducer.js","../src/libs/use-session-event-handler.js","../src/index.js"],"sourcesContent":["import { useReducer, useMemo } from 'react';\n\nconst initialState = {\n  // connection info\n  isSessionInitialized: false,\n  connectionId: undefined,\n  isSessionConnected: false,\n\n  // connected data\n  session: undefined,\n  connections: [],\n  streams: [],\n  subscribers: [],\n  publisher: {},\n};\n\n// ACTION TYPE\nconst UPDATE = 'UPDATE';\nconst ADD_CONNECTION = 'ADD_CONNECTION';\nconst REMOVE_CONNECTION = 'REMOVE_CONNECTION';\nconst ADD_STREAM = 'ADD_STREAM';\nconst REMOVE_STREAM = 'REMOVE_STREAM';\nconst SET_PUBLISHER = 'SET_PUBLISHER';\nconst REMOVE_PUBLISHER = 'REMOVE_PUBLISHER';\nconst ADD_SUBSCRIBER = 'ADD_SUBSCRIBER';\nconst REMOVE_SUBSCRIBER = 'REMOVE_SUBSCRIBER';\n\nconst reducer = (state, action) => {\n  const { type, payload } = action;\n\n  switch (type) {\n    // CONNECT_SUCCESS\n    case UPDATE: {\n      return {\n        ...state,\n        ...payload,\n      };\n    }\n    case ADD_CONNECTION: {\n      return {\n        ...state,\n        connections: [...state.connections, payload],\n      };\n    }\n    case REMOVE_CONNECTION: {\n      return {\n        ...state,\n        connections: [\n          ...state.connections.filter(\n            c => c.connectionId !== payload.connectionId\n          ),\n        ],\n      };\n    }\n    case ADD_STREAM: {\n      return {\n        ...state,\n        streams: [...state.streams, payload],\n      };\n    }\n    case REMOVE_STREAM: {\n      return {\n        ...state,\n        streams: [\n          ...state.streams.filter(s => s.streamId !== payload.streamId),\n        ],\n      };\n    }\n    case SET_PUBLISHER: {\n      const { name, publisher } = payload;\n      return {\n        ...state,\n        publisher: {\n          ...state.publisher,\n          [name]: publisher,\n        },\n      };\n    }\n    case REMOVE_PUBLISHER: {\n      const { name } = payload;\n      return {\n        ...state,\n        publisher: {\n          ...state.publisher,\n          [name]: null,\n        },\n      };\n    }\n    case ADD_SUBSCRIBER: {\n      return {\n        ...state,\n        subscribers: [...state.subscribers, payload],\n      };\n    }\n    case REMOVE_SUBSCRIBER: {\n      return {\n        ...state,\n        subscribers: [\n          ...state.subscribers.filter(s => s.streamId !== payload.streamId),\n        ],\n      };\n    }\n    default:\n      return state;\n  }\n};\n\nconst useOpenTokReducer = () => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const action = useMemo(\n    () => ({\n      update(payload) {\n        dispatch({\n          type: UPDATE,\n          payload,\n        });\n      },\n      addConnection(connection) {\n        dispatch({\n          type: ADD_CONNECTION,\n          payload: connection,\n        });\n      },\n      removeConnection(connection) {\n        dispatch({\n          type: REMOVE_CONNECTION,\n          payload: connection,\n        });\n      },\n      addStream(stream) {\n        dispatch({\n          type: ADD_STREAM,\n          payload: stream,\n        });\n      },\n      removeStream(stream) {\n        dispatch({\n          type: REMOVE_STREAM,\n          payload: stream,\n        });\n      },\n      setPublisher({ name, publisher }) {\n        dispatch({\n          type: SET_PUBLISHER,\n          payload: { name, publisher },\n        });\n      },\n      removePublisher({ name }) {\n        dispatch({\n          type: REMOVE_PUBLISHER,\n          payload: { name },\n        });\n      },\n      addSubscriber(subscriber) {\n        dispatch({\n          type: ADD_SUBSCRIBER,\n          payload: subscriber,\n        });\n      },\n      removeSubscriber(subscriber) {\n        dispatch({\n          type: REMOVE_SUBSCRIBER,\n          payload: subscriber,\n        });\n      },\n    }),\n    []\n  );\n\n  return [state, action];\n};\n\nexport default useOpenTokReducer;\n","import { useEffect } from 'react';\n\nconst events = [\n  'archiveStarted',\n  'archiveStopped',\n  'connectionCreated',\n  'connectionDestroyed',\n  'sessionConnected',\n  'sessionDisconnected',\n  'sessionReconnected',\n  'sessionReconnecting',\n  'signal',\n  'streamCreated',\n  'streamDestroyed',\n  'streamPropertyChanged',\n];\n\nexport default (type, callback, session) => {\n  const isEventTypeSupported = events.some(e => type.startsWith(e));\n  if (!isEventTypeSupported) {\n    throw new Error('The event type is NOT supported');\n  }\n  if (typeof callback !== 'function') {\n    throw new Error('Incorrect value or type of callback');\n  }\n\n  useEffect(() => {\n    const { sessionId } = session || {};\n    if (typeof sessionId !== 'string') {\n      return;\n    }\n\n    session.on(type, callback);\n    return () => {\n      session.off(type, callback);\n    };\n  }, [session, type, callback]);\n};\n","import { useCallback } from 'react';\nimport useOpenTokReducer from './libs/use-opentok-reducer';\nimport useSessionEventHandler from './libs/use-session-event-handler';\nimport OT from '@opentok/client';\n\n// default options for subscribe and initPublisher\nconst defaultOptions = {\n  insertMode: 'append',\n  width: '100%',\n  height: '100%',\n};\n\nconst useOpenTok = () => {\n  const [state, action] = useOpenTokReducer();\n\n  const {\n    isSessionConnected,\n\n    session,\n    subscribers,\n    publisher,\n\n    streams,\n  } = state;\n\n  const handleConnectionCreated = useCallback(\n    event => {\n      action.addConnection(event.connection);\n    },\n    [action]\n  );\n\n  const handleConnectionDestroyed = useCallback(\n    event => {\n      action.removeConnection(event.connection);\n    },\n    [action]\n  );\n\n  const handleStreamCreated = useCallback(\n    event => {\n      action.addStream(event.stream);\n    },\n    [action]\n  );\n\n  const handleStreamDestroyed = useCallback(\n    event => {\n      action.removeStream(event.stream);\n    },\n    [action]\n  );\n\n  const initSession = useCallback(\n    ({ apiKey, sessionId, sessionOptions }) =>\n      new Promise(resolve => {\n        const session = OT.initSession(apiKey, sessionId, sessionOptions);\n        action.update({ session, isSessionInitialized: true });\n        resolve(session);\n      }),\n    [action]\n  );\n\n  const connectSession = useCallback(\n    (token, sessionToConnect) =>\n      new Promise((resolve, reject) => {\n        if (!token) {\n          return reject('[react-use-opentok] token does not exist.');\n        }\n\n        if (!sessionToConnect) {\n          return reject('[react-use-opentok] session does not exist.');\n        }\n\n        sessionToConnect.connect(token, error => {\n          if (error) {\n            reject(error);\n          } else {\n            const connectionId = sessionToConnect.connection.connectionId;\n            action.update({\n              connectionId,\n              isSessionConnected: true,\n            });\n            resolve(connectionId);\n          }\n        });\n      }),\n    [action]\n  );\n\n  const initSessionAndConnect = useCallback(\n    async ({ apiKey, sessionId, token, sessionOptions }) => {\n      const newSession = await initSession({\n        apiKey,\n        sessionId,\n        sessionOptions,\n      });\n\n      await connectSession(token, newSession);\n    },\n    [connectSession, initSession]\n  );\n\n  const disconnectSession = useCallback(() => {\n    session.disconnect();\n    action.update({\n      connectionId: null,\n      isSessionConnected: false,\n      session: undefined,\n    });\n  }, [action, session]);\n\n  const publish = useCallback(\n    ({ name, element, options }) => {\n      if (publisher[name]) {\n        throw new Error(`The publisher(${name}) is already existed`);\n      }\n      \n      return new Promise((resolve, reject) => {\n        const newPublisher = OT.initPublisher(\n          element,\n          { ...defaultOptions, ...options },\n          (error) => {\n            if (error) {\n              reject(error);\n            }\n          }\n        );\n        resolve(newPublisher);\n      }).then((newPublisher) => {\n        return new Promise((resolve, reject) => {\n          session.publish(newPublisher, error => {\n            if (error) {\n              reject(error);\n            } else {\n              action.setPublisher({\n                name,\n                publisher: newPublisher,\n              });\n              action.addStream(newPublisher.stream);\n              resolve(newPublisher.stream);\n            }\n          });\n        });\n      });\n    },\n    [action, publisher, session]\n  );\n\n  const unpublish = useCallback(\n    ({ name }) => {\n      if (!(publisher && publisher[name])) {\n        throw new Error(`[unpublish] publisher[${name}] is undefined`);\n      }\n\n      const stream = publisher && publisher[name] && publisher[name].stream;\n\n      session.unpublish(publisher[name]);\n      action.removePublisher({ name });\n      action.removeStream(stream);\n    },\n    [action, publisher, session]\n  );\n\n  const subscribe = useCallback(\n    ({ stream, element, options }) => {\n      const { streamId } = stream;\n      const pickedStream = streams.find(s => s.streamId === streamId);\n\n      const subscriber = session.subscribe(pickedStream, element, {\n        ...defaultOptions,\n        ...options,\n      });\n\n      action.addSubscriber(subscriber);\n    },\n    [action, session, streams]\n  );\n\n  const unsubscribe = useCallback(\n    ({ stream }) => {\n      const { streamId } = stream;\n      const subscriber = subscribers.find(\n        subscriber => subscriber.streamId === streamId\n      );\n\n      session.unsubscribe(subscriber);\n      action.removeSubscriber(subscriber);\n    },\n    [action, session, subscribers]\n  );\n\n  const sendSignal = useCallback(\n    ({ type, data, completionHandler }) => {\n      if (!isSessionConnected) {\n        throw new Error('Session is not connected');\n      }\n\n      let signal = { data };\n\n      if (typeof type === 'string' && type.length > 0) {\n        signal.type = type;\n      }\n\n      session.signal(signal, error => {\n        if (error) {\n          console.warn('signal error: ' + error.message);\n        } else if (typeof completionHandler === 'function') {\n          completionHandler();\n        }\n      });\n    },\n    [isSessionConnected, session]\n  );\n\n  useSessionEventHandler('connectionCreated', handleConnectionCreated, session);\n  useSessionEventHandler(\n    'connectionDestroyed',\n    handleConnectionDestroyed,\n    session\n  );\n  useSessionEventHandler('streamCreated', handleStreamCreated, session);\n  useSessionEventHandler('streamDestroyed', handleStreamDestroyed, session);\n\n  return [\n    state,\n    {\n      initSessionAndConnect,\n      initSession,\n      connectSession,\n      disconnectSession,\n      publish,\n      unpublish,\n      subscribe,\n      unsubscribe,\n      sendSignal,\n    },\n  ];\n};\n\nexport default useOpenTok;\n"],"names":["initialState","isSessionInitialized","connectionId","undefined","isSessionConnected","session","connections","streams","subscribers","publisher","UPDATE","ADD_CONNECTION","REMOVE_CONNECTION","ADD_STREAM","REMOVE_STREAM","SET_PUBLISHER","REMOVE_PUBLISHER","ADD_SUBSCRIBER","REMOVE_SUBSCRIBER","reducer","state","action","type","payload","filter","c","s","streamId","name","useOpenTokReducer","useReducer","dispatch","useMemo","update","addConnection","connection","removeConnection","addStream","stream","removeStream","setPublisher","removePublisher","addSubscriber","subscriber","removeSubscriber","events","callback","isEventTypeSupported","some","e","startsWith","Error","useEffect","sessionId","on","off","defaultOptions","insertMode","width","height","useOpenTok","handleConnectionCreated","useCallback","event","handleConnectionDestroyed","handleStreamCreated","handleStreamDestroyed","initSession","apiKey","sessionOptions","Promise","resolve","OT","connectSession","token","sessionToConnect","reject","connect","error","initSessionAndConnect","newSession","disconnectSession","disconnect","publish","element","options","newPublisher","initPublisher","then","unpublish","subscribe","pickedStream","find","unsubscribe","sendSignal","data","completionHandler","signal","length","console","warn","message","useSessionEventHandler"],"mappings":"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"}