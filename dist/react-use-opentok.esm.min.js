import{useReducer as e,useMemo as n,useEffect as t,useCallback as r}from"react";import o from"@opentok/client";function i(e,n,t,r,o,i,s){try{var c=e[i](s),a=c.value}catch(e){return void t(e)}c.done?n(a):Promise.resolve(a).then(r,o)}function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function u(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var t=[],r=!0,o=!1,i=void 0;try{for(var s,c=e[Symbol.iterator]();!(r=(s=c.next()).done)&&(t.push(s.value),!n||t.length!==n);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function f(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var d={isSessionInitialized:!1,connectionId:void 0,isSessionConnected:!1,session:void 0,connections:[],streams:[],subscribers:[],publisher:{}},p=function(e,n){var t=n.type,r=n.payload;switch(t){case"UPDATE":return a({},e,{},r);case"ADD_CONNECTION":return a({},e,{connections:[].concat(f(e.connections),[r])});case"REMOVE_CONNECTION":return a({},e,{connections:f(e.connections.filter((function(e){return e.connectionId!==r.connectionId})))});case"ADD_STREAM":return a({},e,{streams:[].concat(f(e.streams),[r])});case"REMOVE_STREAM":return a({},e,{streams:f(e.streams.filter((function(e){return e.streamId!==r.streamId})))});case"SET_PUBLISHER":var o=r.name,i=r.publisher;return a({},e,{publisher:a({},e.publisher,s({},o,i))});case"REMOVE_PUBLISHER":var c=r.name;return a({},e,{publisher:a({},e.publisher,s({},c,null))});case"ADD_SUBSCRIBER":return a({},e,{subscribers:[].concat(f(e.subscribers),[r])});case"REMOVE_SUBSCRIBER":return a({},e,{subscribers:f(e.subscribers.filter((function(e){return e.streamId!==r.streamId})))});default:return e}},l=["archiveStarted","archiveStopped","connectionCreated","connectionDestroyed","sessionConnected","sessionDisconnected","sessionReconnected","sessionReconnecting","signal","streamCreated","streamDestroyed","streamPropertyChanged"],m=function(e,n,r){if(!l.some((function(n){return e.startsWith(n)})))throw new Error("The event type is NOT supported");if("function"!=typeof n)throw new Error("Incorrect value or type of callback");t((function(){if("string"==typeof(r||{}).sessionId)return r.on(e,n),function(){r.off(e,n)}}),[r,e,n])},b={insertMode:"append",width:"100%",height:"100%"};export default function(){var t=function(){var t=u(e(p,d),2),r=t[0],o=t[1];return[r,n((function(){return{update:function(e){o({type:"UPDATE",payload:e})},addConnection:function(e){o({type:"ADD_CONNECTION",payload:e})},removeConnection:function(e){o({type:"REMOVE_CONNECTION",payload:e})},addStream:function(e){o({type:"ADD_STREAM",payload:e})},removeStream:function(e){o({type:"REMOVE_STREAM",payload:e})},setPublisher:function(e){var n=e.name,t=e.publisher;o({type:"SET_PUBLISHER",payload:{name:n,publisher:t}})},removePublisher:function(e){var n=e.name;o({type:"REMOVE_PUBLISHER",payload:{name:n}})},addSubscriber:function(e){o({type:"ADD_SUBSCRIBER",payload:e})},removeSubscriber:function(e){o({type:"REMOVE_SUBSCRIBER",payload:e})}}}),[])]}(),s=u(t,2),c=s[0],f=s[1],l=c.isSessionConnected,y=c.session,h=c.subscribers,v=c.publisher,S=c.streams,E=r((function(e){f.addConnection(e.connection)}),[f]),O=r((function(e){f.removeConnection(e.connection)}),[f]),I=r((function(e){f.addStream(e.stream)}),[f]),w=r((function(e){f.removeStream(e.stream)}),[f]),g=r((function(e){var n=e.apiKey,t=e.sessionId,r=e.sessionOptions;return new Promise((function(e){var i=o.initSession(n,t,r);f.update({session:i,isSessionInitialized:!0}),e(i)}))}),[f]),R=r((function(e,n){return new Promise((function(t,r){return e?n?void n.connect(e,(function(e){if(e)r(e);else{var o=n.connection.connectionId;f.update({connectionId:o,isSessionConnected:!0}),t(o)}})):r("[react-use-opentok] session does not exist."):r("[react-use-opentok] token does not exist.")}))}),[f]),C=r(function(){var e,n=(e=regeneratorRuntime.mark((function e(n){var t,r,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.apiKey,r=n.sessionId,o=n.token,i=n.sessionOptions,e.next=3,g({apiKey:t,sessionId:r,sessionOptions:i});case 3:return s=e.sent,e.next=6,R(o,s);case 6:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,o){var s=e.apply(n,t);function c(e){i(s,r,o,c,a,"next",e)}function a(e){i(s,r,o,c,a,"throw",e)}c(void 0)}))});return function(e){return n.apply(this,arguments)}}(),[R,g]),P=r((function(){y.disconnect(),f.update({connectionId:null,isSessionConnected:!1})}),[f,y]),D=r((function(e){var n=e.name,t=e.element,r=e.options;if(v[n])throw new Error("The publisher(".concat(n,") is already existed"));return new Promise((function(e,n){e(o.initPublisher(t,a({},b,{},r),(function(e){e&&n(e)})))})).then((function(e){return new Promise((function(t,r){y.publish(e,(function(o){o?r(o):(f.setPublisher({name:n,publisher:e}),f.addStream(e.stream),t(e.stream))}))}))}))}),[f,v,y]),A=r((function(e){var n=e.name;if(!v||!v[n])throw new Error("[unpublish] publisher[".concat(n,"] is undefined"));var t=v&&v[n]&&v[n].stream;y.unpublish(v[n]),f.removePublisher({name:n}),f.removeStream(t)}),[f,v,y]),j=r((function(e){var n=e.stream,t=e.element,r=e.options,o=n.streamId,i=S.find((function(e){return e.streamId===o})),s=y.subscribe(i,t,a({},b,{},r));f.addSubscriber(s)}),[f,y,S]),T=r((function(e){var n=e.stream.streamId,t=h.find((function(e){return e.streamId===n}));y.unsubscribe(t),f.removeSubscriber(t)}),[f,y,h]),_=r((function(e){var n=e.type,t=e.data,r=e.completionHandler;if(!l)throw new Error("Session is not connected");var o={data:t};"string"==typeof n&&n.length>0&&(o.type=n),y.signal(o,(function(e){e?console.warn("signal error: "+e.message):"function"==typeof r&&r()}))}),[l,y]);return m("connectionCreated",E,y),m("connectionDestroyed",O,y),m("streamCreated",I,y),m("streamDestroyed",w,y),[c,{initSessionAndConnect:C,initSession:g,connectSession:R,disconnectSession:P,publish:D,unpublish:A,subscribe:j,unsubscribe:T,sendSignal:_}]}
//# sourceMappingURL=react-use-opentok.esm.min.js.map
